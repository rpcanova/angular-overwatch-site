<div class="container__hero-details page-container">
    <div *ngIf="loading" class="hero-details__loading">
        <app-loading-spinner 
            size="medium" 
            message="Loading hero details..." 
            [showMessage]="true">
        </app-loading-spinner>
    </div>

    <div *ngIf="error" class="hero-details__error">
        <div class="error__icon">‚ö†Ô∏è</div>
        <h2>Error loading hero</h2>
        <p>It wasn't possible to load hero. Try again.</p>
        <button class="btn-secondary" (click)="goBack()">Return to Hero List</button>
    </div>

    <div *ngIf="hero && !loading && !error" class="hero-details__content">
        <div class="hero-content__header">
            <button class="btn-secondary" (click)="goBack()">
                Return
            </button>

            <div class="hero-content__basic-info">
                <div class="basic-info__portrait">
                    <img [src]="hero.portrait" [alt]="hero.name">
                </div>
                
                <div class="basic-info__details">
                    <h1 class="details__name gradient-text">{{ hero.name }}</h1>
                    <div class="details__role">
                        <span class="role-badge" [class]="'role-badge' + hero.role.toLowerCase()">
                            {{ hero.role }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="hero-details__story">
            <div class="story__header">
                <h2>Story</h2>
                <div class="story__divider gradient-divider"></div>
            </div>
            
            <div class="story__content">
                <p>{{ hero.story.summary }}</p>
                
                <!-- Media Section (Video or Comic) -->
                <div *ngIf="hero.story.media && hero.story.media.link" class="story__media">
                    <h3>Hero Introduction</h3>
                    <div class="media__container">
                        <!-- Comic Button -->
                        <div *ngIf="hero.story.media.type === 'comic'" class="comic__section">
                            <button 
                                class="btn-comic" 
                                (click)="openComic(hero.story.media!.link)"
                                type="button">
                                <span class="comic__icon">üìñ</span>
                                <span class="comic__text">Read Comic</span>
                            </button>
                        </div>
                        
                        <!-- YouTube Video -->
                        <iframe 
                            *ngIf="hero.story.media.type !== 'comic' && isYouTubeLink(hero.story.media.link)"
                            [src]="getYouTubeEmbedUrl(hero.story.media.link) | safe"
                            frameborder="0"
                            allowfullscreen
                            class="hero-video youtube-video">
                        </iframe>
                        
                        <!-- Direct Video -->
                        <video 
                            *ngIf="hero.story.media.type !== 'comic' && !isYouTubeLink(hero.story.media.link)"
                            [src]="hero.story.media.link"
                            controls 
                            preload="metadata"
                            class="hero-video">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>
        </div>

        <!-- Abilities Section -->
        <div class="hero-details__abilities" *ngIf="hero.abilities && hero.abilities.length > 0">
            <div class="abilities__header">
                <h2>Abilities</h2>
                <div class="abilities__divider gradient-divider"></div>
            </div>
            
            <div class="abilities__grid">
                <div class="ability__card" *ngFor="let ability of hero.abilities">
                    <div class="ability__header">
                        <img *ngIf="ability.icon" [src]="ability.icon" [alt]="ability.name" class="ability__icon">
                        <h3 class="ability__name">{{ ability.name }}</h3>
                    </div>
                    
                    <p class="ability__description">{{ ability.description }}</p>
                    
                    <!-- Ability Video -->
                    <div *ngIf="ability.video && ability.video.link" class="ability__video">
                        <video 
                            [src]="getVideoSource(ability.video.link)" 
                            [poster]="ability.video.thumbnail"
                            controls 
                            preload="metadata"
                            class="ability-video">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>
        </div>

        <app-cta 
            [title]="'Want to know more about ' + hero.name + '?'"
            description="Explore more details about this hero in Overwatch 2!"
        >
        </app-cta>
    </div>
</div>